# iOS快捷指令创建指南

## 📱 小红书→flomo 快捷指令

### 🎯 核心设计
- **iOS端获取HTML** → 绕过服务器反爬虫
- **服务端只负责解析** → 速度快（260ms）
- **支持从剪贴板或分享菜单调用**

---

## 🔧 详细创建步骤

### 1️⃣ 获取剪贴板

**动作**：获取剪贴板
- 无需配置

---

### 2️⃣ 提取URL

**动作**：从输入获取URL
- **输入**：选择"剪贴板"

---

### 3️⃣ 获取HTML内容（关键步骤）

**动作**：获取URL的内容

**配置**：
- **URL**：选择"URL"
- **方法**：GET
- 点击"显示更多"

**请求头**（点击"添加新字段"）：

```
字段1:
键: User-Agent
值: Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1

字段2:
键: Accept
值: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8

字段3:
键: Accept-Language
值: zh-CN,zh;q=0.9,en;q=0.8

字段4:
键: Accept-Encoding
值: gzip, deflate, br
```

---

### 4️⃣ 调用解析API

**动作**：获取URL的内容

**配置**：
- **URL**：`https://your-domain.vercel.app/api/parse`
  - ⚠️ **请替换为你的实际域名**
- **方法**：POST
- **请求体**：JSON

**请求头**：
```
键: Content-Type
值: application/json
```

**请求体JSON**（完整复制粘贴）：

```json
{
  "url": "URL变量",
  "output_format": "flomo",
  "options": {
    "preloadedHtml": "URL的内容变量"
  }
}
```

**⚠️ 重要**：在输入JSON时：
1. 输入 `"url": "`后，点击变量按钮，选择"URL"（步骤2的输出）
2. 输入 `"preloadedHtml": "`后，点击变量按钮，选择"URL的内容"（步骤3的输出）

---

### 5️⃣ 提取结果URL

**动作**：获取字典值

**配置**：
- **获取**：输入 `ios_url`
- **从**：选择"URL的内容"（步骤4的输出）

---

### 6️⃣ 打开flomo

**动作**：打开URL

**配置**：
- **URL**：选择"字典值"（步骤5的输出）

---

## ⚙️ 快捷指令设置

点击快捷指令右上角的设置图标（⋯）：

### 基本信息
- **名称**：小红书→flomo
- **图标**：选择一个喜欢的图标（建议：📝 或 🔴）
- **颜色**：红色

### 共享表单设置
打开 **"在共享表单中显示"**
- **接受类型**：URL、文本
- **描述**：从小红书保存到flomo

### 隐私设置
- **允许共享**：打开（如果要分享给朋友）

---

## 📱 使用方法

### 方法1：从剪贴板
```
1. 在小红书App中，点击"分享" → "复制链接"
2. 打开"快捷指令"App
3. 点击"小红书→flomo"
4. 等待2-3秒，自动跳转到flomo
```

### 方法2：从分享菜单（推荐）
```
1. 在小红书App中浏览内容
2. 点击"分享"按钮
3. 滑动找到"快捷指令" → 选择"小红书→flomo"
4. 自动完成并跳转到flomo
```

---

## 🔍 变量流转图

```
步骤1: 获取剪贴板
   ↓
   输出: "剪贴板"（文本）

步骤2: 从输入获取URL
   ↓
   输入: "剪贴板"
   输出: "URL"（URL对象）

步骤3: 获取URL的内容 (GET)
   ↓
   输入: "URL"
   输出: "URL的内容"（HTML文本）

步骤4: 获取URL的内容 (POST)
   ↓
   输入: "URL" + "URL的内容"
   输出: "URL的内容"（JSON响应）
   注意：这里会覆盖步骤3的"URL的内容"变量

步骤5: 获取字典值
   ↓
   输入: "URL的内容"（步骤4的JSON）
   输出: "字典值"（ios_url字符串）

步骤6: 打开URL
   ↓
   输入: "字典值"
```

⚠️ **变量命名冲突注意**：
步骤3和步骤4都输出"URL的内容"，系统会自动处理，但建议：
- 步骤5选择变量时，选择**最近的**"URL的内容"（即步骤4的输出）

---

## 🐛 常见问题

### 问题1：找不到"URL的内容"变量
**解决**：确保前面的步骤已经正确配置，特别是步骤3和步骤4

### 问题2：打开URL失败
**原因**：API返回的不是ios_url
**检查**：
1. API域名是否正确
2. 在步骤4后添加"显示通知"查看返回内容
3. 确认返回的JSON包含 `ios_url` 字段

### 问题3：获取HTML内容超时
**原因**：网络问题或小红书服务器响应慢
**解决**：
1. 确保iPhone网络正常
2. User-Agent必须正确设置
3. 可以增加超时时间（步骤3的高级设置）

### 问题4：解析失败
**检查**：
1. 复制的链接是否完整
2. API服务是否正常运行
3. 查看步骤4返回的error字段

---

## 📊 性能对比

| 方案 | 获取方式 | 解析位置 | 速度 | 成功率 |
|------|---------|---------|------|--------|
| 旧方案 | 服务器GET | 服务器 | 11s | 中等 |
| 新方案 | iOS端GET | 服务器 | 0.3s | 高 |

**新方案优势**：
- ✅ 速度快40倍
- ✅ 绕过反爬虫
- ✅ 降低服务器压力
- ✅ 更稳定可靠

---

## 🎨 自定义选项

### 发送到备忘录
将步骤4的JSON改为：
```json
{
  "url": "URL",
  "output_format": "notes",
  "options": {
    "preloadedHtml": "URL的内容"
  }
}
```

### 获取原始数据
将步骤4的JSON改为：
```json
{
  "url": "URL",
  "output_format": "raw",
  "options": {
    "preloadedHtml": "URL的内容"
  }
}
```
然后在步骤5之后添加"显示结果"查看完整数据

---

## 🔐 隐私说明

- ✅ 所有数据处理在你的iPhone和服务器之间
- ✅ 不会发送到第三方服务
- ✅ HTML内容仅用于解析，不会保存
- ✅ 可以自己部署服务器，完全掌控数据

---

## 📝 测试清单

创建完成后，请测试以下场景：

- [ ] 从剪贴板调用（复制链接后运行快捷指令）
- [ ] 从分享菜单调用（小红书App内分享）
- [ ] 验证flomo是否正确打开
- [ ] 验证内容是否完整（标题、正文、图片）
- [ ] 测试无效链接的错误处理

---

## 🚀 下一步

1. **创建更多变体**：
   - 小红书→备忘录
   - B站→flomo
   - 微信公众号→flomo

2. **添加错误处理**：
   - 检查剪贴板是否为空
   - 检查API响应是否成功
   - 显示友好的错误提示

3. **优化用户体验**：
   - 添加进度通知
   - 添加成功/失败音效
   - 添加快捷操作菜单

---

需要帮助？遇到问题？
- 检查本文档的"常见问题"部分
- 确认API服务已正确部署
- 使用"显示通知"动作调试各步骤输出
